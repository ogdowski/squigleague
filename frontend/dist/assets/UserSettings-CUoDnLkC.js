import{u as D,f as r,p as U,l as C,c as i,b as t,g as V,h as g,i as x,v as y,t as h,j as _,o as d}from"./index-CRTPRc-Y.js";const B={class:"max-w-2xl mx-auto"},F={class:"card"},M={key:0,class:"text-center py-12"},q={key:1},A={key:0,class:"bg-red-900/30 border border-red-500 text-red-200 px-4 py-3 rounded"},E={key:1,class:"bg-green-900/30 border border-green-500 text-green-200 px-4 py-3 rounded"},L={class:"flex gap-4"},N=["disabled"],$={__name:"UserSettings",setup(R){const c="/api",p=D(),f=r(!0),m=r(!1),n=r(""),o=r(!1),a=r({email:"",username:""}),l=r({email:"",username:""}),b=U(()=>a.value.username!==l.value.username||a.value.email!==l.value.email),S=async()=>{try{const u=await _.get(`${c}/auth/me`);a.value.email=u.data.email,a.value.username=u.data.username,l.value={...a.value}}catch{n.value="Failed to load user data"}finally{f.value=!1}},k=async()=>{var u,e;if(b.value){m.value=!0,n.value="",o.value=!1;try{const s={};a.value.username!==l.value.username&&(s.username=a.value.username),a.value.email!==l.value.email&&(s.email=a.value.email);const v=await _.patch(`${c}/auth/me`,s);p.user.username=v.data.username,p.user.email=v.data.email,l.value.username=v.data.username,l.value.email=v.data.email,o.value=!0,setTimeout(()=>{o.value=!1},3e3)}catch(s){n.value=((e=(u=s.response)==null?void 0:u.data)==null?void 0:e.detail)||"Failed to update settings"}finally{m.value=!1}}},w=()=>{a.value={...l.value},n.value="",o.value=!1};return C(()=>{S()}),(u,e)=>(d(),i("div",B,[t("div",F,[e[5]||(e[5]=t("h1",{class:"text-3xl font-bold mb-6"},"Settings",-1)),f.value?(d(),i("div",M,[...e[2]||(e[2]=[t("p",{class:"text-xl text-gray-300"},"Loading...",-1)])])):(d(),i("div",q,[t("form",{onSubmit:V(k,["prevent"]),class:"space-y-6"},[t("div",null,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium mb-2"}," Email ",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.value.email=s),type:"email",class:"input-field w-full",required:""},null,512),[[y,a.value.email]])]),t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium mb-2"}," Username ",-1)),x(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.username=s),type:"text",class:"input-field w-full",minlength:"3",maxlength:"100",required:""},null,512),[[y,a.value.username]])]),n.value?(d(),i("div",A,h(n.value),1)):g("",!0),o.value?(d(),i("div",E," Settings updated successfully! ")):g("",!0),t("div",L,[t("button",{type:"submit",disabled:m.value||!b.value,class:"btn-primary flex-1"},h(m.value?"Saving...":"Save Changes"),9,N),t("button",{type:"button",onClick:w,class:"btn-secondary flex-1"}," Reset ")])],32)]))])]))}};export{$ as default};
