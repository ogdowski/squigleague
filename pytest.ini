[pytest]
# Pytest configuration for Squig League

# Python path - include root directory for imports
pythonpath = .

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Directories to search for tests
testpaths = tests

# Markers for categorizing tests
markers =
    unit: Unit tests (fast, isolated functions)
    integration: Integration tests (real database, API)
    slow: Tests that take longer than 1 second
    asyncio: Asynchronous tests (requires pytest-asyncio)

# Coverage configuration
addopts =
    # Verbose output
    -v
    # Show summary of all test outcomes
    -ra
    # Show local variables in tracebacks
    --showlocals
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Strict config (fail on config issues)
    --strict-config
    # Enable coverage by default (can be disabled with --no-cov)
    --cov=herald
    --cov=squire
    # Coverage report format
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    # Fail if coverage is below 100%
    --cov-fail-under=100
    # Show warning summary
    -Wd

# Asyncio mode (required for pytest-asyncio)
asyncio_mode = auto

# Minimum Python version
minversion = 3.11

# Console output style
console_output_style = progress

# Test execution order (random for detecting state dependencies)
# Uncomment to enable random test execution:
# --random-order

# Timeout for tests (fail if test takes longer than 60s)
# Uncomment to enable timeout:
# --timeout=60

# Parallel execution (uncomment to run tests in parallel)
# -n auto

# Log level for test output
log_cli = false
log_cli_level = INFO

# Warnings
filterwarnings =
    # Treat warnings as errors (strict)
    error
    # Except for these specific warnings
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning

# Coverage exclusions
[coverage:run]
omit =
    # Test files themselves
    tests/*
    # Virtual environment
    .venv/*
    venv/*
    # Configuration files
    */conftest.py
    # Development scripts
    scripts/*
    # Migrations
    */migrations/*

[coverage:report]
# Show missing lines in terminal report
show_missing = true

# Fail if coverage is below 100%
fail_under = 100

# Exclude patterns
exclude_lines =
    # Exclude pragma comments
    pragma: no cover
    # Exclude abstract methods
    @abstract
    # Exclude if TYPE_CHECKING blocks
    if TYPE_CHECKING:
    # Exclude NotImplementedError
    raise NotImplementedError
    # Exclude pass statements
    pass
    # Exclude ... (ellipsis)
    \.\.\.

# Precision for coverage percentage
precision = 2

[coverage:html]
# HTML report output directory
directory = htmlcov

[coverage:xml]
# XML report output file
output = coverage.xml
